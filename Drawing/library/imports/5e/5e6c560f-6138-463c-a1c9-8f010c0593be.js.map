{"version":3,"sources":["../../../../assets/scripts/assets/scripts/PaperController.js"],"names":["paperModel","require","cc","Class","extends","Component","properties","paperPrefab","Prefab","loadView","Node","audios","default","url","AudioClip","onLoad","items","resources","loadDragonBones","loadPaperFrames","self","loader","loadResDir","err","assets","length","names","resAssets","resAtlasAssets","paperFrames","i","asset","SpriteFrame","name","lastIndexOf","push","dragonBones","DragonBonesAsset","substr","DragonBonesAtlasAsset","resource","atlasAsset","paperFrame","spriteFrame","spriteFrames","updateUI","item","instantiate","sf","node","addChild","getComponent","updateSpriteFrame","active","showClick","Global","selectIndex","selectPaper","index","Tool","play","orginItem","hideClick","selectedItem","onEvent","start"],"mappings":"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","file":"PaperController.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\n\nvar paperModel = require(\"Model\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        paperPrefab : cc.Prefab,\n        loadView : cc.Node,\n        audios:{\n            default: [],\n            url: [cc.AudioClip]\n        },\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.items = [];\n        this.resources = []\n        this.loadDragonBones();\n        this.loadPaperFrames();\n\n    },\n\n\n    //加载资源\n    loadDragonBones () {\n        var self = this;\n        cc.loader.loadResDir('dragonBones', function(err, assets){\n            if(err){\n                return;\n            }\n            if(assets.length <= 0){\n                return;\n            }\n            var names = [];        \n            var resAssets = [];\n            var resAtlasAssets = [];\n            var paperFrames = [];\n\n            for(var i in assets){\n                let asset = assets[i] ;\n                if(asset instanceof cc.SpriteFrame){\n                    if (asset.name.lastIndexOf(\"_tex\") == -1){\n                        paperFrames.push(asset)\n                    }\n                }\n                if(asset instanceof dragonBones.DragonBonesAsset){\n                    let name = asset.name\n                    names.push(name.substr(0,name.lastIndexOf(\"_ske\")));//_ske\n                    resAssets.push(asset);\n                }\n                if(asset instanceof dragonBones.DragonBonesAtlasAsset){\n                    resAtlasAssets.push(asset);\n                }\n            }\n            for(var i in names){\n                var resource = new paperModel()\n                resource.name = names[i];\n                resource.asset = resAssets[i];\n                resource.atlasAsset = resAtlasAssets[i];\n                resource.paperFrame = paperFrames[i];\n                resource.spriteFrame = null;\n                self.resources.push(resource);\n            }\n        });\n    },\n\n    loadPaperFrames (){\n        var self = this;\n        cc.loader.loadResDir('papers', function(err, assets){\n            if(err){\n                return;\n            }\n            if(assets.length <= 0){\n                return;\n            }\n\n            var names = [];\n            var paperFrames = [];\n            var spriteFrames = [];\n\n            for(var i in assets){\n                let asset = assets[i] ;\n                if(asset instanceof cc.SpriteFrame){\n                    let name = asset.name\n                    if (asset.name.lastIndexOf(\"_01\") > 0){\n                        names.push(name.substr(0,name.lastIndexOf(\"_01\")));\n                        spriteFrames.push(asset);\n                    }else if (asset.name.lastIndexOf(\"_02\") > 0){\n                        paperFrames.push(asset);\n                    }\n                }\n            }\n\n            for(var i in names){\n                var resource = new paperModel()\n                resource.name = names[i];\n                resource.asset = null;\n                resource.atlasAsset = null;\n                resource.paperFrame = paperFrames[i];\n                resource.spriteFrame = spriteFrames[i];\n                self.resources.push(resource);\n            }\n        \n            self.updateUI()\n\n        });\n    },\n\n\n    updateUI () {\n\n        for (var i in this.resources) {\n            this.resources[i].url = this.audios[i];\n            var item = cc.instantiate(this.paperPrefab);\n            var sf = this.resources[i].paperFrame;\n            this.node.addChild(item);\n            item.getComponent('PaperPrefab').updateSpriteFrame(this,sf,i)\n            this.items.push(item)\n        }\n\n        this.loadView.active = false\n        var item = this.items[0].getComponent('PaperPrefab');\n        item.showClick();\n        Global.paperModel = this.resources[0];\n        this.selectIndex = 0;\n    },\n\n\n    selectPaper: function (index) {\n\n        Tool.play(this.audios[index]);\n\n        var orginItem = this.items[this.selectIndex].getComponent('PaperPrefab');\n        orginItem.hideClick();\n\n        this.selectIndex = index;\n\n        var selectedItem = this.items[this.selectIndex].getComponent('PaperPrefab');\n\n        selectedItem.showClick();\n\n        Global.paperModel = this.resources[this.selectIndex];\n\n        Tool.onEvent('Sticker', this.resources[this.selectIndex].name);\n\n    },\n\n\n    start () {\n\n    },\n\n    // update (dt) {},\n});\n"]}