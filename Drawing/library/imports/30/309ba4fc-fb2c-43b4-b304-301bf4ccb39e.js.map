{"version":3,"sources":["../../../../assets/scripts/assets/scripts/HomeUI.js"],"names":["httpUtils","require","paperModel","DrawingState","cc","Enum","draw","rubber","paper","Class","extends","Component","properties","bgImageView","Sprite","menu","Layout","subMenu","Node","shareView","phoneDesk","phoneDeskAnim","Animation","rightView","backBtn","Button","panWidth","rubberWidth","beginAudio","default","url","AudioClip","onLoad","Tool","onEvent","play","getComponent","menuIndex","menuBtns","node","getComponentsInChildren","setMenuIndex","is_click","drawing_state","set_touch_ctrl","self","mhight","getContentSize","height","vsibleWidth","director","getVisibleSize","width","rt","RenderTexture","_sgNode","addChild","begin","end","touchId","on","EventType","TOUCH_START","touch","event","__instanceId","touchLoc","getLocation","Global","asset","paperTaget","armatureDisplay","addComponent","dragonBones","ArmatureDisplay","dragonAsset","dragonAtlasAsset","atlasAsset","armatureName","addEventListener","EventObject","COMPLETE","animationEventHandler","START","spritf","spriteFrame","convertToNodeSpaceAR","position","v2","x","y","originPoint","drawWithLocation","bind","TOUCH_MOVE","TOUCH_END","console","log","playAnimation","name","visit","removeFromParent","parent","TOUCH_CANCEL","e1","DrawNode","drawSegment","color","ctx","_renderCmd","_cacheContext","getContext","locCanvas","_cacheCanvas","setTransform","setFillStyle","fillRect","lineCap","lineJoin","lineWidth","save","beginPath","moveTo","lineTo","stroke","restore","type","globalCompositeOperation","loc","currentTarget","getPosition","setPosition","set_drawing_state","num","parseInt","set_pan_color","hexToColor","set_bg_image","sf","t","index","oV","ol","Label","v","l","showShareView","showSubBtns","state","requestUrl","checkClient","isOtt","uri","isIOS","isAndroid","post","active","setTimeout","screenShot","back","isShow","sys","localStorage","getItem","kf","close","setItem","phoneDeskClick","addShortcut","JSON","stringify","revokePath","clear","update","dt"],"mappings":"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","file":"HomeUI.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["import {deskIcon} from \"Global\"\r\nimport Req from 'request'\r\nimport { ENFILE } from \"constants\";\r\n\r\nvar httpUtils = require(\"HttpUtils\");\r\nvar paperModel = require(\"Model\");\r\n\r\nvar DrawingState = cc.Enum({\r\n    draw : 0,\r\n    rubber : 1,\r\n    paper : 2\r\n});\r\n\r\ncc.Class({\r\n\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        bgImageView : cc.Sprite,\r\n        menu : cc.Layout,\r\n        subMenu : cc.Node,\r\n        shareView : cc.Node,\r\n        phoneDesk : cc.Node,\r\n        phoneDeskAnim: cc.Animation,\r\n        rightView : cc.Node,\r\n        backBtn : cc.Button,\r\n        panWidth : 0,\r\n        rubberWidth : 0,\r\n        beginAudio:{\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        \r\n        // if (channel) {\r\n        //     Tool.onEvent(channel);\r\n        // }\r\n\r\n        Tool.onEvent('Start');\r\n        Tool.play(this.beginAudio);\r\n        this.subMenu = this.subMenu.getComponent('SubBtnsUI');\r\n        this.menuIndex = 1;\r\n        this.menuBtns = this.menu.node.getComponentsInChildren(cc.Button);\r\n        this.setMenuIndex(null,1);\r\n        this.is_click = false;\r\n        this.drawing_state = DrawingState.draw;\r\n        this.set_touch_ctrl();\r\n\r\n    },\r\n\r\n    //设置touch事件\r\n    set_touch_ctrl : function(){\r\n\r\n        var self = this;\r\n        let mhight = self.node.getContentSize().height;\r\n        this.vsibleWidth = 1640 - (1920 - cc.director.getVisibleSize().width);//实际宽度\r\n        self.rt = new cc.RenderTexture(this.vsibleWidth, mhight);\r\n        self.node._sgNode.addChild(self.rt);\r\n        self.rt.begin();\r\n        self.rt.end();\r\n        self.touchId = null;\r\n\r\n        //TOUCH_START\r\n        this.node.on(cc.Node.EventType.TOUCH_START,function(touch,event){\r\n\r\n            if (self.touchId != null) {\r\n                return false;\r\n            }\r\n\r\n            self.touchId = touch.touch.__instanceId;\r\n            var touchLoc = touch.getLocation();\r\n\r\n            if (self.drawing_state == DrawingState.paper && Global.paperModel) {\r\n                if (Global.paperModel.asset) {\r\n                    self.paperTaget  = new cc.Node()\r\n                    self.node.addChild(self.paperTaget);\r\n                    self.armatureDisplay = self.paperTaget.addComponent(dragonBones.ArmatureDisplay);\r\n                    self.armatureDisplay.dragonAsset = Global.paperModel.asset\r\n                    self.armatureDisplay.dragonAtlasAsset = Global.paperModel.atlasAsset\r\n                    self.armatureDisplay.armatureName = 'Armature';\r\n                    self.armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE, self.animationEventHandler, self);\r\n                    self.armatureDisplay.addEventListener(dragonBones.EventObject.START, self.animationEventHandler, self);\r\n                }else{\r\n                    self.armatureDisplay = null;\r\n                    self.paperTaget  = new cc.Node()\r\n                    self.node.addChild(self.paperTaget);\r\n                    let spritf = self.paperTaget.addComponent(cc.Sprite);\r\n                    spritf.spriteFrame = Global.paperModel.spriteFrame\r\n                }\r\n                \r\n                touchLoc = self.node.convertToNodeSpaceAR(touchLoc);\r\n                self.paperTaget.position = cc.v2(touchLoc.x ,touchLoc.y)\r\n                return true\r\n            }\r\n\r\n            self.originPoint = touchLoc;\r\n            self.is_click=true;\r\n            self.drawWithLocation(touchLoc);\r\n            touchLoc.x += 1;\r\n            touchLoc.y += 1;\r\n            self.drawWithLocation(touchLoc);\r\n            return true;\r\n\r\n        }.bind(this),this.node)\r\n\r\n        //TOUCH_MOVE\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE,function(touch,event){\r\n\r\n            if (self.touchId != touch.touch.__instanceId){\r\n                return false;\r\n            }\r\n\r\n            var touchLoc = touch.getLocation();\r\n\r\n            if (self.drawing_state == DrawingState.paper && Global.paperModel) {\r\n                touchLoc = self.node.convertToNodeSpaceAR(touchLoc);\r\n                self.paperTaget.position = cc.v2(touchLoc.x ,touchLoc.y)\r\n                return true\r\n            }\r\n\r\n            self.drawWithLocation(touchLoc);\r\n\r\n            return true;\r\n            \r\n        }.bind(this),this.node)\r\n\r\n        //TOUCH_END\r\n        this.node.on(cc.Node.EventType.TOUCH_END,function(touch,event){\r\n            if (self.touchId != touch.touch.__instanceId){\r\n                return false;\r\n            }\r\n\r\n            console.log('TOUCH_END');\r\n\r\n            self.touchId = null;\r\n            var touchLoc = touch.getLocation();\r\n\r\n            if (self.drawing_state == DrawingState.paper && Global.paperModel) {\r\n                touchLoc = self.node.convertToNodeSpaceAR(touchLoc);\r\n                \r\n                if (self.armatureDisplay) {\r\n                    self.paperTaget.position = cc.v2(touchLoc.x ,touchLoc.y)\r\n                    self.armatureDisplay.playAnimation(Global.paperModel.name,1);\r\n                    \r\n                }else{\r\n                    touchLoc.x += self.vsibleWidth / 2;\r\n                    touchLoc.y += self.node.getContentSize().height / 2;\r\n                    self.paperTaget.position = cc.v2(touchLoc.x ,touchLoc.y)\r\n                    self.rt.begin();\r\n                    self.paperTaget._sgNode.visit();\r\n                    self.rt.end();\r\n                    self.paperTaget.removeFromParent()\r\n                }\r\n                \r\n                return true\r\n            }\r\n\r\n            if(self.is_click){\r\n                self.is_click = false;\r\n            }    \r\n\r\n        }.bind(this),this.node)\r\n\r\n        //TOUCH_CANCEL\r\n        this.node.parent.on(cc.Node.EventType.TOUCH_CANCEL,function(touch){\r\n\r\n            if (self.touchId == touch.touch.__instanceId){\r\n                if (self.drawing_state == DrawingState.paper && Global.paperModel) {\r\n                    self.paperTaget.removeFromParent()\r\n                }\r\n                console.log('TOUCH_CANCEL');\r\n            }\r\n\r\n            self.touchId = null;\r\n            self.is_click = false;\r\n\r\n            \r\n        }.bind(this),this.node)\r\n        \r\n    },\r\n\r\n\r\n\r\n    //画画 、 橡皮\r\n    drawWithLocation : function (touchLoc) {\r\n\r\n        var self = this;\r\n\r\n        if(!self.is_click){\r\n            return;   \r\n        }  \r\n\r\n        \r\n        // console.log(self.rt._renderCmd);\r\n        \r\n        touchLoc = self.node.convertToNodeSpaceAR(touchLoc);\r\n        touchLoc.x += self.vsibleWidth / 2;\r\n        touchLoc.y += self.node.height / 2;\r\n        //涂色\r\n        if(self.drawing_state == DrawingState.draw){\r\n            let originPoint = self.originPoint;\r\n            let e1 = new cc.DrawNode();\r\n            // e1.glEnable( cc.GL_LINE_SMOOTH);\r\n            e1.drawSegment(originPoint, touchLoc, self.panWidth, self.color);\r\n            self.rt.begin();\r\n            e1.visit();\r\n            self.rt.end();\r\n            self.originPoint = touchLoc;\r\n        }\r\n        //橡皮擦\r\n        else if(self.drawing_state == DrawingState.rubber){\r\n\r\n            let originPoint = self.originPoint;\r\n            var ctx = self.rt._renderCmd._cacheContext.getContext();\r\n\r\n            var locCanvas = self.rt._renderCmd._cacheCanvas;\r\n            ctx.setTransform(1,0,0,1,0,0);\r\n            self.rt._renderCmd._cacheContext.setFillStyle(\"rgba(0,0,0,0)\");\r\n            ctx.fillRect(touchLoc.x-30,1080-touchLoc.y-30,60,60);\r\n\r\n            ctx.lineCap = \"round\";\r\n\t\t    ctx.lineJoin = \"round\";\r\n\t\t    ctx.lineWidth = 60;\r\n            \r\n            ctx.save();\r\n            ctx.beginPath();\r\n            ctx.moveTo(originPoint.x,1080-originPoint.y);\r\n            ctx.lineTo(touchLoc.x,1080-touchLoc.y);\r\n            ctx.stroke();\r\n            ctx.restore();\r\n\r\n            self.originPoint = touchLoc;\r\n        }\r\n    },\r\n\r\n\r\n    //贴纸动画结束\r\n    animationEventHandler: function(event) {\r\n        var self = this\r\n        if (event.type === dragonBones.EventObject.COMPLETE) {\r\n\r\n            if (self.drawing_state == DrawingState.rubber){\r\n                var ctx = this.rt._renderCmd._cacheContext.getContext();\r\n                ctx.globalCompositeOperation = \"source-over\";\r\n            }\r\n\r\n            var loc = event.currentTarget.parent.getPosition();\r\n            loc.x += self.vsibleWidth / 2;\r\n            loc.y += self.node.getContentSize().height / 2;\r\n            event.currentTarget.parent.setPosition(loc.x ,loc.y);\r\n    \r\n            self.rt.begin();\r\n            event.currentTarget.parent.visit();\r\n            self.rt.end();\r\n            event.currentTarget.parent.removeFromParent()\r\n\r\n            if (self.drawing_state == DrawingState.rubber){\r\n                var ctx = this.rt._renderCmd._cacheContext.getContext();\r\n                ctx.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        }\r\n    },\r\n\r\n    //画板状态\r\n    set_drawing_state : function(num){\r\n        num = parseInt(num);\r\n        this.drawing_state = num;\r\n\r\n        if (this.rt) {\r\n            if (num == DrawingState.rubber){\r\n                var ctx = this.rt._renderCmd._cacheContext.getContext();\r\n                ctx.globalCompositeOperation = \"destination-out\";\r\n            }else{\r\n                var ctx = this.rt._renderCmd._cacheContext.getContext();\r\n                ctx.globalCompositeOperation = \"source-over\";\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    //画笔颜色\r\n    set_pan_color : function(color) {\r\n        this.color = cc.hexToColor(color)\r\n    },\r\n\r\n    //画板背景\r\n    set_bg_image : function(sf){\r\n        this.bgImageView.spriteFrame = sf;\r\n    },\r\n\r\n    //菜单选中\r\n    setMenuIndex : function(t,index) {\r\n        index = parseInt(index);\r\n\r\n        var oV = this.menuBtns[this.menuIndex].node.getComponentsInChildren(cc.Sprite)[1];\r\n        var ol = this.menuBtns[this.menuIndex].node.getComponentsInChildren(cc.Label)[0];\r\n\r\n        oV.node.color = cc.hexToColor(\"753D32\");\r\n        ol.node.color = cc.hexToColor(\"FFFFFF\");\r\n\r\n        var v = this.menuBtns[index].node.getComponentsInChildren(cc.Sprite)[1];\r\n        var l = this.menuBtns[index].node.getComponentsInChildren(cc.Label)[0];\r\n\r\n        v.node.color = cc.hexToColor(\"FEF0C4\");\r\n        l.node.color = cc.hexToColor(\"753D32\");\r\n\r\n        this.menuIndex = index;\r\n\r\n\r\n        switch (index) {\r\n            case 0:\r\n                Tool.onEvent('Finish');\r\n                this.showShareView();\r\n                this.showSubBtns(-1);\r\n                break;\r\n            case 1:\r\n                Tool.onEvent('Brush');\r\n                this.set_drawing_state(DrawingState.draw);\r\n                this.showSubBtns(0);\r\n                break;\r\n            case 2:\r\n                Tool.onEvent('Sticker');\r\n                this.set_drawing_state(DrawingState.paper);\r\n                this.showSubBtns(1);\r\n                break;\r\n            case 3:\r\n                this.set_drawing_state(DrawingState.rubber);\r\n                this.showSubBtns(-1);\r\n                break;\r\n            case 4:\r\n                Tool.onEvent('Background');\r\n                this.showSubBtns(2);\r\n                break;\r\n        }\r\n\r\n    },\r\n\r\n    showSubBtns : function (state) {\r\n        this.subMenu.showSubBtns(state)\r\n    },\r\n\r\n    //分享页面\r\n    showShareView :  function(){\r\n\r\n        var requestUrl = null\r\n        \r\n        if (Tool.checkClient().isOtt){\r\n            requestUrl = Global.uri + '/zxottpad/achv/event'\r\n        }else if (Tool.checkClient().isIOS || Tool.checkClient().isAndroid) {\r\n            requestUrl = Global.uri + '/mgxbapp/achv/event'\r\n        }\r\n\r\n        if (requestUrl){\r\n            Req.post(requestUrl, {\r\n                'content-type': 'application/json'\r\n            }, { 'event_type': 'drawing' })\r\n        }\r\n        \r\n        this.rightView.active = false;\r\n        this.backBtn.node.active = false;\r\n        var self = this\r\n\r\n        setTimeout(function(){\r\n            var locCanvas = self.rt._renderCmd._cacheCanvas;\r\n            self.shareView.getComponent('ShareView').screenShot(function () {\r\n                self.shareView.active = true;\r\n                self.rightView.active = true;\r\n                self.backBtn.node.active = true;\r\n            });\r\n        },100); \r\n        \r\n    },\r\n\r\n    //back\r\n    back : function(){\r\n\r\n        var isShow = cc.sys.localStorage.getItem('phoneDeskIsShow')\r\n\r\n        if (isShow) {\r\n            if (kf != null){\r\n                kf.close();\r\n            }\r\n        }else{\r\n            cc.sys.localStorage.setItem('phoneDeskIsShow','true')\r\n            this.phoneDesk.active = true;\r\n        }\r\n        \r\n    },\r\n\r\n    //添加桌面图标\r\n    phoneDeskClick : function(t,index){\r\n\r\n        \r\n\r\n        if (index == 0) {\r\n            if (kf != null){\r\n                kf.close();\r\n            }\r\n        }else if (index == 1 || index == 2){\r\n\r\n            if (index == 1) {\r\n                Tool.onEvent('Back_Desk');\r\n            }else{\r\n                Tool.onEvent('Desk');\r\n            }\r\n            \r\n\r\n            this.phoneDesk.active = false;\r\n            if (kf != null){\r\n                if (Tool.checkClient().isIOS) {\r\n                    kf.addShortcut('https://static.xingbook.com/shortcut.html?icon=https://xb-3sc.xingbook.com/xb-3sc/icon.png&title=%e7%94%bb%e6%9d%bf&scheme=xbmg%3a%2f%2ffullScreenWeb%3flandscape%3dtrue%26url%3dhttps%3a%2f%2fgo.xingbook.com%2fdoV%3fchannel%3dshortcut');\r\n                }else if (Tool.checkClient().isAndroid) {\r\n                    kf.addShortcut(JSON.stringify({\r\n                        'image' : 'https://xb-3sc.xingbook.com/xb-3sc/icon.png',\r\n                        'name' : '画板',\r\n                        'url' : 'xbmg://fullScreenWeb?landscape=true&url=https://go.xingbook.com/doV?channel=shortcut',\r\n                    }))\r\n                }\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    //清空\r\n    revokePath : function () {\r\n        this.rt.clear(0,0,0,0);\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    update: function (dt) {\r\n\r\n    },\r\n\r\n});\r\n"]}