{"version":3,"sources":["singleBodyOnPlane.js"],"names":["singleBodyOnPlane","cc","_decorator","ccclass","property","Number","scene","node","parent","sphere","getChildByName","cube","bodies","initCannon","world","CANNON","quatNormalizeSkip","quatNormalizeFast","gravity","set","broadphase","NaiveBroadphase","mass","radius","sphereShape","Sphere","boxShape","Box","Vec3","sphereBody","Body","addShape","position","boxBody","addBody","push","groundShape","Plane","groundBody","quaternion","setFromAxisAngle","Math","PI","dt","step","on","Node","EventType","TRANSFORM_CHANGED","updateSpherePhy","updateCubePhy","setPosition","Component"],"mappings":"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","sourcesContent":["\n@cc._decorator.ccclass()\n\nclass singleBodyOnPlane extends cc.Component {\n    @cc._decorator.property(Number)\n\n    start() {\n        const scene = this.node.parent;\n\n        const sphere = scene.getChildByName('Sphere');\n        const cube = scene.getChildByName('Cube');\n        // const ground = scene.getChildByName('Ground').getComponent(cc.ModelComponent).mesh;\n\n        // let sphereMesh = sphere.getComponent(cc.ModelComponent).mesh;\n        // let cubeMesh = cube.getComponent(cc.ModelComponent).mesh;\n\n\n        // let meshs = [sphereMesh, cubeMesh];\n        let bodies = [];\n\n        initCannon();\n\n\n        function initCannon() {\n            let world = new CANNON();\n            world.quatNormalizeSkip = 0;\n            world.quatNormalizeFast = false;\n            world.gravity.set(0, -10, 0);\n            world.broadphase = new CANNON.NaiveBroadphase();\n\n            let mass = 1.0, radius = 1.3;\n\n            let sphereShape = new CANNON.Sphere(1.0);\n            let boxShape = new CANNON.Box(new CANNON.Vec3(1.0, 1.0, 1.0));\n\n            let sphereBody = new CANNON.Body({mass: mass});\n            sphereBody.addShape(sphereShape);\n            sphereBody.position.set(0, 20, 0);\n\n\n            let boxBody = new CANNON.Body({mass: mass});\n            boxBody.addShape(boxShape);\n            boxBody.position.set(20, 20, 0);\n\n            world.addBody(sphereBody);\n            world.addBody(boxBody);\n\n            bodies.push(sphereBody);\n            bodies.push(boxBody);\n\n            let groundShape = new CANNON.Plane();\n            let groundBody = new CANNON.Body({mass: 0});\n            groundBody.addShape(groundShape);\n            groundBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2);\n            world.addBody(groundBody);\n\n            let dt = 1 / 60;\n            world.step(dt);\n\n            sphere.on(cc.Node.EventType.TRANSFORM_CHANGED, updateSpherePhy);\n            cube.on(cc.Node.EventType.TRANSFORM_CHANGED, updateCubePhy);\n\n\n            function updateSpherePhy() {\n                sphere.setPosition(bodies[0].position);\n            }\n\n            function updateCubePhy() {\n                cube.setPosition( bodies[1].position);\n            }\n\n        }\n\n\n\n    }\n}\n"]}